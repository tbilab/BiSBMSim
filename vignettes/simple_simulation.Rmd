---
title: "Simple Simulation"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{simple_simulation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 6
)
```

```{r setup}
# library(bisbmsim)

library(tidyverse)
library(purrr)
```


This document represents the first steps of the package and an example of a super simple simulation. 

First we need to setup basic parameters corresponding to model
```{r}
N_a <- 125  # Number of nodes of the a type
N_b <- 105  # Number of nodes of the b type
K_a <- 4    # How many blocks of a type nodes are there
K_b <- 3    # How many blocks of the b type nodes are there
```

In the future these variables will be chosen, not generated.
```{r}
b_a <- rep(1:K_a, length.out = N_a) # Block membership for each a node (automated in future)
b_b <- rep(1:K_b, length.out = N_b) # Block membership for each b node
```

### Average number of connections between each pair of a and b groups
```{r}
Lambda <- expand.grid(
  a = 1:K_a,
  b = 1:K_b
) %>% 
  mutate(
    avg_num_cons = runif(n())
  )
```



Look at what our Lambda looks like real quick.

```{r}
ggplot(Lambda, aes(x = a, y = b)) +
  geom_tile(
    aes(fill = avg_num_cons),
    color = 'white'
  ) +
  scale_fill_gradient(low = "white", high = "#56B1F7")

```



## Now we can begin simulation

```{r}
all_node_pairs <- expand.grid(
  a = 1:N_a,
  b = 1:N_b
) %>% 
  # Grab the group membership for each node
  mutate(
    a_group = b_a[a],
    b_group = b_b[b]
  ) %>% 
  inner_join(
    Lambda,
    by = c('a_group' = 'a', 'b_group' = 'b')
  ) %>% 
  mutate(
    num_connections = rpois(n(), lambda = avg_num_cons)
  )
```


Plot results and compare with the generating lambda matrix. 
```{r}
all_node_pairs %>% 
  mutate(num_connections = ifelse(num_connections >= 1, 1, 0)) %>% 
  gather(key = 'type', value = 'connections', avg_num_cons, num_connections) %>% 
  arrange(a_group, b_group) %>% 
  ggplot(aes(x = reorder(a, a_group), y = reorder(b, b_group))) +
  geom_tile(aes(fill = connections) ) +
  facet_wrap(~type) +
  scale_fill_gradient(low = "white", high = "#56B1F7") + 
  labs(
    x = 'a node',
    y = 'b node'
  ) +
  theme_minimal() +
  theme(
    axis.text = element_blank()
  )
```

